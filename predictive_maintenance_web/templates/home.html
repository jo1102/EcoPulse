<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoPulse - Energy Management Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        :root {
            --aramco-green: #84BD00;
            --aramco-dark-green: #00843D;
            --aramco-blue: #00A3E0;
            --aramco-dark-blue: #0033A0;
            --aramco-white: #FFFFFF;
            --aramco-dark-gray: #323232;
        }
        
        body {
            background: linear-gradient(135deg, #FFFFFF 0%, #F8F9FA 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: var(--aramco-dark-gray);
        }
        
        .navbar {
            background: var(--aramco-white) !important;
            backdrop-filter: blur(10px);
            border-bottom: 2px solid var(--aramco-blue);
        }
        
        .card {
            background: var(--aramco-white);
            backdrop-filter: blur(10px);
            border: 2px solid var(--aramco-blue);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 163, 224, 0.1);
            transition: all 0.3s ease;
            color: var(--aramco-dark-gray);
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.15);
        }
        
        .metric-card {
            text-align: center;
            padding: 2rem;
            position: relative;
            overflow: hidden;
        }
        
        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--aramco-green), var(--aramco-blue));
        }
        
        .metric-value {
            font-size: 3.5rem;
            font-weight: 800;
            color: var(--aramco-green);
            line-height: 1.2;
        }
        
        .metric-label {
            font-size: 1.1rem;
            color: var(--aramco-dark-gray);
            font-weight: 600;
            margin-top: 0.5rem;
        }
        
        .metric-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            opacity: 0.8;
        }
        
        .power-icon { color: var(--aramco-green); }
        .clean-icon { color: var(--aramco-blue); }
        .netzero-icon { color: var(--aramco-dark-green); }
        
        .maintenance-item {
            border-left: 4px solid;
            padding: 1rem;
            margin: 0.5rem 0;
            border-radius: 8px;
            background: var(--aramco-white);
            border: 1px solid #E9ECEF;
            transition: all 0.3s ease;
            color: var(--aramco-dark-gray);
        }
        
        .maintenance-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .urgency-critical { border-left-color: #dc3545; background: rgba(220, 53, 69, 0.1); }
        .urgency-high { border-left-color: #fd7e14; background: rgba(253, 126, 20, 0.1); }
        .urgency-medium { border-left-color: #ffc107; background: rgba(255, 193, 7, 0.1); }
        .urgency-low { border-left-color: var(--aramco-green); background: rgba(40, 167, 69, 0.1); }
        
        .chart-container {
            height: 350px;
            border-radius: 15px;
            overflow: hidden;
        }
        
        .navbar-brand {
            color: var(--aramco-dark-gray) !important;
            font-weight: bold;
        }
        
        .btn-outline-light {
            color: var(--aramco-blue) !important;
            border-color: var(--aramco-blue) !important;
            font-weight: bold;
        }
        
        .btn-outline-light:hover {
            background-color: var(--aramco-blue) !important;
            border-color: var(--aramco-blue) !important;
            color: white !important;
        }
        
        h1, h2, h3, h4, h5, h6, .card-title {
            color: var(--aramco-dark-gray) !important;
            font-weight: bold;
        }
        
        .metric-card {
            text-align: center;
            padding: 2rem;
            position: relative;
            overflow: hidden;
        }
        
        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--aramco-green), var(--aramco-blue));
        }
        
        .metric-value {
            font-size: 3.5rem;
            font-weight: 800;
            color: var(--aramco-green);
            line-height: 1.2;
        }
        
        .metric-label {
            font-size: 1.1rem;
            color: var(--aramco-dark-gray);
            font-weight: 600;
            margin-top: 0.5rem;
        }
        
        .metric-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            opacity: 0.8;
        }
        
        .power-icon { color: var(--aramco-green); }
        .clean-icon { color: var(--aramco-blue); }
        .netzero-icon { color: var(--aramco-dark-green); }
        
        .maintenance-item {
            border-left: 4px solid;
            padding: 1rem;
            margin: 0.5rem 0;
            border-radius: 8px;
            background: var(--aramco-white);
            border: 1px solid #E9ECEF;
            transition: all 0.3s ease;
            color: var(--aramco-dark-gray);
        }
        
        .maintenance-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .urgency-critical { border-left-color: #dc3545; background: rgba(220, 53, 69, 0.1); }
        .urgency-high { border-left-color: #fd7e14; background: rgba(253, 126, 20, 0.1); }
        .urgency-medium { border-left-color: #ffc107; background: rgba(255, 193, 7, 0.1); }
        .urgency-low { border-left-color: var(--eco-green); background: rgba(40, 167, 69, 0.1); }
        
        .chart-container {
            height: 350px;
            border-radius: 15px;
            overflow: hidden;
        }
        
        .nav-pills .nav-link {
            border-radius: 20px;
            padding: 0.75rem 1.5rem;
            margin: 0 0.25rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .nav-pills .nav-link.active {
            background: linear-gradient(135deg, var(--eco-green), var(--eco-blue));
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        .loading { animation: pulse 1.5s ease-in-out infinite; }
    </style>
</head>
<body>
    <nav class="navbar navbar-dark sticky-top">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1">
                <i class="fas fa-leaf"></i> EcoPulse Energy Management
            </span>
            <div class="d-flex">
                <a href="/current-status" class="btn btn-outline-light me-2">
                    <i class="fas fa-tachometer-alt"></i> Current Status
                </a>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <!-- Charts Row -->
        <div class="row mb-4">
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header bg-transparent">
                        <h5 class="mb-0">
                            <i class="fas fa-bolt text-warning"></i> Power Distribution
                        </h5>
                    </div>
                    <div class="card-body">
                        <div id="power-chart" class="chart-container"></div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header bg-transparent">
                        <h5 class="mb-0">
                            <i class="fas fa-wind text-success"></i> Clean Energy Mix
                        </h5>
                    </div>
                    <div class="card-body">
                        <div id="clean-chart" class="chart-container"></div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header bg-transparent">
                        <h5 class="mb-0">
                            <i class="fas fa-leaf text-primary"></i> Net Zero Components
                        </h5>
                    </div>
                    <div class="card-body">
                        <div id="netzero-chart" class="chart-container"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- UFD Data Integration Info -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-transparent">
                        <h5 class="mb-0">
                            <i class="fas fa-database text-info"></i> 
                            Real Sensor Data Integration
                        </h5>
                    </div>
                    <div class="card-body">
                        <div id="ufd-integration-info" class="row">
                            <div class="col-12 text-center loading">
                                <div class="spinner-border text-info" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                                <p class="mt-2 text-muted">Loading UFD sensor data integration status...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Critical Maintenance Section -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-transparent">
                        <h5 class="mb-0">
                            <i class="fas fa-exclamation-triangle text-danger"></i> 
                            Critical Maintenance Items
                        </h5>
                    </div>
                    <div class="card-body">
                        <div id="maintenance-items" class="row">
                            <div class="col-12 text-center loading">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                                <p class="mt-2 text-muted">Loading maintenance data...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            loadHomeData();
            loadUFDIntegrationInfo();
        });

        async function loadHomeData() {
            try {
                console.log('Loading home data...');
                const response = await fetch('/api/home_data');
                console.log('Response status:', response.status);
                const data = await response.json();
                console.log('Response data:', data);
                
                if (data.status === 'success') {
                    // Create charts with the data
                    createPowerChart(data.power_percentage);
                    createCleanChart(data.clean_percentage);
                    createNetZeroChart(data.net_zero_percentage);
                    
                    // Display maintenance items from current status maintenance management
                    await loadCriticalMaintenanceItems();
                    console.log('Home data loaded successfully');
                } else {
                    console.warn('API returned error status:', data.message);
                    throw new Error(data.message || 'Failed to load data');
                }
            } catch (error) {
                console.error('Error loading home data:', error);
                
                // Show error in charts
                document.getElementById('power-chart').innerHTML = 
                    '<div class="alert alert-danger">Error loading power data<br><small>' + error.message + '</small></div>';
                document.getElementById('clean-chart').innerHTML = 
                    '<div class="alert alert-danger">Error loading clean energy data<br><small>' + error.message + '</small></div>';
                document.getElementById('netzero-chart').innerHTML = 
                    '<div class="alert alert-danger">Error loading net zero data<br><small>' + error.message + '</small></div>';
                    
                document.getElementById('maintenance-items').innerHTML = 
                    '<div class="col-12"><div class="alert alert-danger">Error loading maintenance data<br><small>' + error.message + '</small></div></div>';
            }
        }

        async function loadUFDIntegrationInfo() {
            try {
                const response = await fetch('/api/ufd_data_analysis');
                const data = await response.json();
                
                if (data.status === 'success') {
                    displayUFDIntegrationInfo(data.analysis);
                } else {
                    document.getElementById('ufd-integration-info').innerHTML = 
                        '<div class="col-12"><div class="alert alert-warning">UFD data not available</div></div>';
                }
            } catch (error) {
                console.error('Error loading UFD integration info:', error);
                document.getElementById('ufd-integration-info').innerHTML = 
                    '<div class="col-12"><div class="alert alert-danger">Error loading UFD data</div></div>';
            }
        }

        function displayUFDIntegrationInfo(analysis) {
            const container = document.getElementById('ufd-integration-info');
            
            let html = `
                <div class="col-md-3">
                    <div class="text-center">
                        <div class="metric-value text-info">${analysis.meters_analyzed}</div>
                        <div class="metric-label">UFD Meters</div>
                        <small class="text-muted">Integrated sensors</small>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="text-center">
                        <div class="metric-value text-success">${analysis.models_trained}</div>
                        <div class="metric-label">ML Models</div>
                        <small class="text-muted">Trained on sensor data</small>
                    </div>
                </div>
                <div class="col-md-6">
                    <h6 class="mb-3">Real-Time Sensor Mapping:</h6>
                    <div class="row">
            `;
            
            const meterMapping = {
                'A': { name: 'Solar Panels', icon: 'fa-sun', color: 'warning' },
                'B': { name: 'Wind Turbines', icon: 'fa-wind', color: 'info' },
                'C': { name: 'Hydrogen Generators', icon: 'fa-bolt', color: 'primary' },
                'D': { name: 'Oil & Gas Systems', icon: 'fa-fire', color: 'danger' }
            };
            
            Object.entries(analysis.meter_details).forEach(([meterId, details]) => {
                const mapping = meterMapping[meterId];
                const healthColor = details.current_health < 2 ? 'success' : 
                                  details.current_health < 3 ? 'warning' : 'danger';
                
                html += `
                    <div class="col-6 mb-2">
                        <div class="d-flex align-items-center">
                            <i class="fas ${mapping.icon} text-${mapping.color} me-2"></i>
                            <div class="flex-grow-1">
                                <small><strong>Meter ${meterId}</strong>: ${mapping.name}</small><br>
                                <small class="text-muted">
                                    Health: <span class="badge bg-${healthColor}">${details.current_health}</span>
                                    | Samples: ${details.total_samples}
                                </small>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += `
                    </div>
                </div>
            `;
            
            html += `
                <div class="col-12 mt-3">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i>
                        <strong>Live Integration:</strong> This dashboard uses real UFD (Ultrasonic Flow meter Degradation) 
                        sensor data to predict maintenance needs. Each energy source is mapped to actual sensor readings 
                        from flow meters, with machine learning models trained on historical patterns.
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
        }

        function createPowerChart(percentage) {
            // Start with 0 values for animation
            const initialData = [{
                type: 'pie',
                sort: false,
                values: [0, 100],
                labels: ['Active Power', 'Available Capacity'],
                hole: 0.6,
                marker: {
                    colors: ['#ffc107', '#e9ecef']
                },
                textinfo: 'none',
                hovertemplate: '%{label}: %{value}%<extra></extra>',
                rotation: 0, 
                direction: 'counterclockwise' // Use counterclockwise for consistent anticlockwise direction
            }];

            const layout = {
                showlegend: false,
                margin: { t: 20, b: 20, l: 20, r: 20 },
                annotations: [{
                    text: '0%<br><span style="font-size:16px; font-weight:bold;">Power</span>',
                    font: { size: 28, color: '#495057', weight: 'bold', family: 'Arial Black, sans-serif' },
                    showarrow: false,
                    x: 0.5,
                    y: 0.5
                }],
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)'
            };

            // Create chart with initial 0 values
            Plotly.newPlot('power-chart', initialData, layout, {responsive: true, displayModeBar: false});

            // Animate to final values
            setTimeout(() => {
                const steps = 30;
                let currentStep = 0;
                
                const animateStep = () => {
                    currentStep++;
                    const progress = currentStep / steps;
                    const currentValue = percentage * progress;
                    
                    const animatedData = {
                        values: [[currentValue, 100 - currentValue]] // Original order
                    };
                    
                    const animatedAnnotation = {
                        'annotations[0].text': Math.round(currentValue) + '%<br><span style="font-size:16px; font-weight:bold;">Power</span>'
                    };
                    
                    Plotly.restyle('power-chart', animatedData);
                    Plotly.relayout('power-chart', animatedAnnotation);
                    
                    if (currentStep < steps) {
                        setTimeout(animateStep, 50);
                    }
                };
                
                animateStep();
            }, 200);
        }

        function createCleanChart(percentage) {
            // Start with 0 values for animation
            const initialData = [{
                type: 'pie',
                sort: false,
                values: [0, 100],
                labels: ['Clean Energy', 'Traditional'],
                hole: 0.6,
                marker: {
                    colors: ['#28a745', '#e9ecef']
                },
                textinfo: 'none',
                hovertemplate: '%{label}: %{value}%<extra></extra>',
                rotation: 0, 
                direction: 'counterclockwise' // Use counterclockwise for consistent anticlockwise direction
            }];

            const layout = {
                showlegend: false,
                margin: { t: 20, b: 20, l: 20, r: 20 },
                annotations: [{
                    text: '0%<br><span style="font-size:16px; font-weight:bold;">Clean</span>',
                    font: { size: 28, color: '#495057', weight: 'bold', family: 'Arial Black, sans-serif' },
                    showarrow: false,
                    x: 0.5,
                    y: 0.5
                }],
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)'
            };

            // Create chart with initial 0 values
            Plotly.newPlot('clean-chart', initialData, layout, {responsive: true, displayModeBar: false});

            // Animate to final values with delay
            setTimeout(() => {
                const steps = 30;
                let currentStep = 0;
                
                const animateStep = () => {
                    currentStep++;
                    const progress = currentStep / steps;
                    const currentValue = percentage * progress;
                    
                    const animatedData = {
                        values: [[currentValue, 100 - currentValue]] // Original order
                    };
                    
                    const animatedAnnotation = {
                        'annotations[0].text': Math.round(currentValue) + '%<br><span style="font-size:16px; font-weight:bold;">Clean</span>'
                    };
                    
                    Plotly.restyle('clean-chart', animatedData);
                    Plotly.relayout('clean-chart', animatedAnnotation);
                    
                    if (currentStep < steps) {
                        setTimeout(animateStep, 50);
                    }
                };
                
                animateStep();
            }, 600); // Delayed start for staggered effect
        }

        function createNetZeroChart(percentage) {
            // Start with 0 values for animation
            const initialData = [{
                type: 'pie',
                sort: false,
                values: [0, 100],
                labels: ['Net Zero Progress', 'Remaining'],
                hole: 0.6,
                marker: {
                    colors: ['#007bff', '#e9ecef']
                },
                textinfo: 'none',
                hovertemplate: '%{label}: %{value}%<extra></extra>',
                rotation: 0, 
                direction: 'clockwise' // Use counterclockwise for consistent anticlockwise direction
            }];

            const layout = {
                showlegend: false,
                margin: { t: 20, b: 20, l: 20, r: 20 },
                annotations: [{
                    text: '0%<br><span style="font-size:16px; font-weight:bold;">Net Zero</span>',
                    font: { size: 28, color: '#495057', weight: 'bold', family: 'Arial Black, sans-serif' },
                    showarrow: false,
                    x: 0.5,
                    y: 0.5
                }],
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)'
            };

            // Create chart with initial 0 values
            Plotly.newPlot('netzero-chart', initialData, layout, {responsive: true, displayModeBar: false});

            // Animate to final values with longer delay
            setTimeout(() => {
                const steps = 30;
                let currentStep = 0;
                
                const animateStep = () => {
                    currentStep++;
                    const progress = currentStep / steps;
                    const currentValue = percentage * progress;
                    
                    const animatedData = {
                        values: [[currentValue, 100 - currentValue]] // Original order
                    };
                    
                    const animatedAnnotation = {
                        'annotations[0].text': Math.round(currentValue) + '%<br><span style="font-size:16px; font-weight:bold;">Net Zero</span>'
                    };
                    
                    Plotly.restyle('netzero-chart', animatedData);
                    Plotly.relayout('netzero-chart', animatedAnnotation);
                    
                    if (currentStep < steps) {
                        setTimeout(animateStep, 50);
                    }
                };
                
                animateStep();
            }, 1000); // Longest delay for staggered effect
        }

        function displayMaintenanceItems(items) {
            const container = document.getElementById('maintenance-items');
            
            if (!items || items.length === 0) {
                container.innerHTML = `
                    <div class="col-12">
                        <div class="alert alert-success">
                            <i class="fas fa-check-circle"></i> No critical maintenance items at this time.
                        </div>
                    </div>
                `;
                return;
            }

            let html = '';
            items.forEach(item => {
                const priorityClass = `urgency-${item.priority.toLowerCase()}`;
                const priorityIcon = item.priority === 'Critical' ? 'exclamation-triangle' : 
                                   item.priority === 'High' ? 'exclamation-circle' : 
                                   item.priority === 'Medium' ? 'exclamation' : 'info-circle';
                
                const performanceImpact = getPerformanceImpact(item.priority, item.id);
                
                html += `
                    <div class="col-md-6 mb-3">
                        <div class="maintenance-item ${priorityClass}">
                            <div class="d-flex justify-content-between align-items-start">
                                <div class="flex-grow-1">
                                    <h6 class="mb-2">
                                        <i class="fas fa-${priorityIcon}"></i> ${item.equipment}
                                    </h6>
                                    <p class="mb-2 text-muted small">${item.issue}</p>
                                    <div class="d-flex gap-2 flex-wrap mb-2">
                                        <span class="badge bg-danger">${item.priority}</span>
                                        <span class="badge bg-info">${item.category}</span>
                                        <span class="badge bg-secondary">${item.status}</span>
                                    </div>
                                    <div class="row text-center">
                                        <div class="col-6">
                                            <div class="text-warning fw-bold">${item.estimated_days} days</div>
                                            <small class="text-muted">Time to Fix</small>
                                        </div>
                                        <div class="col-6">
                                            <div class="text-danger fw-bold">-${performanceImpact}%</div>
                                            <small class="text-muted">Performance Drop</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="text-end">
                                    <div class="h4 mb-0 text-danger">-${performanceImpact}%</div>
                                    <small class="text-muted">Impact</small>
                                    <div class="mt-1">
                                        <small class="text-muted">${item.due_date}</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function getPriorityBadgeClass(priority) {
            switch(priority) {
                case 'Critical': return 'danger';
                case 'High': return 'warning';
                case 'Medium': return 'info';
                default: return 'secondary';
            }
        }

        // Load critical maintenance items from current status maintenance management
        async function loadCriticalMaintenanceItems() {
            try {
                const response = await fetch('/api/maintenance_items?category=all');
                const data = await response.json();
                
                if (data.status === 'success') {
                    // Filter for only Critical priority items that aren't completed
                    const criticalItems = data.maintenance_items.filter(item => 
                        item.priority === 'Critical' && 
                        item.status !== 'Completed'
                    );
                    
                    // Sort by performance impact (highest first)
                    criticalItems.sort((a, b) => {
                        const aImpact = getPerformanceImpact(a.priority, a.id);
                        const bImpact = getPerformanceImpact(b.priority, b.id);
                        return bImpact - aImpact; // Descending order (highest impact first)
                    });
                    
                    displayMaintenanceItems(criticalItems);
                } else {
                    document.getElementById('maintenance-items').innerHTML = 
                        '<div class="col-12"><div class="alert alert-warning">Unable to load critical maintenance items.</div></div>';
                }
            } catch (error) {
                console.error('Error loading critical maintenance:', error);
                document.getElementById('maintenance-items').innerHTML = 
                    '<div class="col-12"><div class="alert alert-danger">Error loading maintenance data<br><small>' + error.message + '</small></div></div>';
            }
        }

        // Get performance impact based on priority and equipment ID
        function getPerformanceImpact(priority, itemId) {
            const impactMap = {
                1: { 'Critical': 22.5, 'High': 16.8, 'Medium': 11.2, 'Low': 5.1 },
                2: { 'Critical': 18.9, 'High': 13.4, 'Medium': 8.7, 'Low': 4.2 },
                3: { 'Critical': 25.3, 'High': 19.1, 'Medium': 12.6, 'Low': 6.8 },
                4: { 'Critical': 15.7, 'High': 11.9, 'Medium': 7.3, 'Low': 3.5 },
                5: { 'Critical': 21.4, 'High': 15.6, 'Medium': 10.1, 'Low': 4.9 },
                6: { 'Critical': 19.8, 'High': 14.2, 'Medium': 9.4, 'Low': 4.7 },
                7: { 'Critical': 17.6, 'High': 12.8, 'Medium': 8.1, 'Low': 3.8 },
                8: { 'Critical': 28.2, 'High': 21.7, 'Medium': 14.3, 'Low': 7.9 }
            };
            
            const itemImpacts = impactMap[itemId];
            return itemImpacts ? itemImpacts[priority] || 20.0 : 20.0;
        }

        // Auto-refresh every 30 seconds
        setInterval(() => {
            loadHomeData();
            loadUFDIntegrationInfo();
        }, 30000);
    </script>
</body>
</html>